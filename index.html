<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Year Tracker Grid</title>
  <style>
    :root{
      --border: #cfcfcf;
      --invalid: #c9c9c9;

      --white: #ffffff;
      --green: #9be7a1;
      --orange: #ffb86b;
      --red: #ff6b6b;

      --today-outline: #111;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

      /* tweak these if you want bigger/smaller cells */
      --gap: 4px;
      --label-col: 44px; /* row label width */
      --header-h: 26px;  /* month header height */
    }

    body{
      margin: 0;
      padding: 10px;
      font-family: var(--font);
      background: transparent;
    }

    /* Make it fit nicely in an iframe / CodiMD page */
    .wrap{
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    .grid{
      width: 100%;
      display: grid;
      grid-template-columns: var(--label-col) repeat(12, 1fr);
      gap: var(--gap);
      align-items: stretch;
      box-sizing: border-box;
    }

    .corner{
      height: var(--header-h);
    }

    .month{
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 650;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #fff;
      font-size: clamp(11px, 1.2vw, 14px);
      user-select: none;
    }

    .daylabel{
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #fff;
      font-variant-numeric: tabular-nums;
      font-size: clamp(11px, 1.2vw, 14px);
      user-select: none;
      aspect-ratio: 1/1; /* keep row labels square-ish */
    }

    .cell{
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--white);
      cursor: pointer;
      aspect-ratio: 1/1; /* squares that scale with width */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(10px, 1.1vw, 13px);
      user-select: none;
      box-sizing: border-box;
      position: relative;
    }

    .cell.invalid{
      background: var(--invalid);
      cursor: not-allowed;
      opacity: 0.9;
    }

    .cell.c0{ background: var(--white); }
    .cell.c1{ background: var(--green); }
    .cell.c2{ background: var(--orange); }
    .cell.c3{ background: var(--red); }

    .cell.today{
      outline: 2px solid var(--today-outline);
      outline-offset: 1px;
    }
    .cell.today::after{
      content: "";
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      right: 4px;
      top: 4px;
      background: var(--today-outline);
      opacity: 0.65;
      pointer-events: none;
    }

    /* “Week” separators: thicker border under day 7,14,21,28 (applied to whole row) */
    .week-sep{
      box-shadow: 0 3px 0 0 #00000014; /* subtle divider */
    }

    /* Optional: reduce padding on very narrow screens */
    @media (max-width: 520px){
      body{ padding: 6px; }
      :root{ --gap: 3px; --label-col: 38px; --header-h: 24px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="grid" class="grid" aria-label="Year tracker grid"></div>
  </div>

<script>
(() => {
  // === Minimal settings ===
  // Change this if you want a fixed year:
  // const YEAR = 2026;
  const today = new Date();
  const YEAR = today.getFullYear();

  const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const COLORS = ["c0","c1","c2","c3"];
  const STORAGE_KEY = `month_day_grid_v1_${YEAR}`;

  const grid = document.getElementById("grid");

  function isLeapYear(y){
    return (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);
  }

  const monthLen = [31, isLeapYear(YEAR) ? 29 : 28, 31,30,31,30,31,31,30,31,30,31];

  function pad2(n){ return String(n).padStart(2,"0"); }
  function ymd(y,m,d){ return `${y}-${pad2(m)}-${pad2(d)}`; } // m=1..12, d=1..31

  // state: key "YYYY-MM-DD" -> 0..3
  let state = {};
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) state = JSON.parse(raw) || {};
  } catch { state = {}; }

  function save(){
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
  }

  function build(){
    grid.innerHTML = "";

    // Corner (empty)
    const corner = document.createElement("div");
    corner.className = "corner";
    grid.appendChild(corner);

    // Month headers
    for (let m = 1; m <= 12; m++){
      const h = document.createElement("div");
      h.className = "month";
      h.textContent = MONTHS[m-1];
      h.title = `${YEAR}-${pad2(m)}`;
      grid.appendChild(h);
    }

    // Rows: day 1..31
    const todayKey = ymd(today.getFullYear(), today.getMonth()+1, today.getDate());

    for (let d = 1; d <= 31; d++){
      const dl = document.createElement("div");
      dl.className = "daylabel";
      dl.textContent = String(d);
      dl.title = `Day ${d}`;
      if ([7,14,21,28].includes(d)) dl.classList.add("week-sep");
      grid.appendChild(dl);

      for (let m = 1; m <= 12; m++){
        const cell = document.createElement("div");
        cell.classList.add("cell");

        const valid = d <= monthLen[m-1];
        if (!valid){
          cell.classList.add("invalid");
          cell.title = "Invalid date";
          if ([7,14,21,28].includes(d)) cell.classList.add("week-sep");
          grid.appendChild(cell);
          continue;
        }

        const key = ymd(YEAR, m, d);
        const v = Number.isInteger(state[key]) ? state[key] : 0;
        cell.classList.add(COLORS[v]);
        cell.title = key;

        if (key === todayKey) cell.classList.add("today");
        if ([7,14,21,28].includes(d)) cell.classList.add("week-sep");

        cell.addEventListener("click", () => {
          const cur = Number.isInteger(state[key]) ? state[key] : 0;
          const next = (cur + 1) % 4;
          state[key] = next;
          cell.classList.remove(...COLORS);
          cell.classList.add(COLORS[next]);
          save();
        });

        grid.appendChild(cell);
      }
    }
  }

  build();
})();
</script>
</body>
</html>
